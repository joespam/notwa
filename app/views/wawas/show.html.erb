<div class="container">

<h1 class="blog-title"><%= "[#{@wawa.city}, #{@wawa.state} #{@wawa.zip}]" %></h1>
	<div class="row">

		<div class="col-sm-8 blog-main">
			<div class="row">
			   <div class="col-sm-4">   
					<% if @wawa.prime_photo.exists? %>
						<%= image_tag @wawa.prime_photo.url(:medium) %>
					<% end %>
					<% if current_user && current_user.admin %>
						<%= link_to "edit this wawa", edit_wawa_path(@wawa.id), class: "btn btn-default", type: "button" %>
					<% end %>
					<p><%= link_to "Comment", "#add_comment_lb", class: "fancybox btn btn-default" %></p>
				</div>

				<div class="col-sm-8">
				   <div id="gmap"></div>
				</div>
			</div>

			<% if @comments %>
				<% @comments.each_with_index do |comment, index| %>

					<% if index%2 > 0 %>
						<div class="blog-post">
					<% else %>
						 <div class="well">
					<% end %>
					<div class="row">

						<div class="col-sm-9 col-sm-offset-3">
							<p><%= "#{comment.updated_at.strftime("%d/%m/%Y %H:%M")}"%> by <%= comment_username comment %></p>
							<br>
							<p><%= comment.body %></p>
						</div>
					</div>
						<% if current_user && current_user.id == comment.user_id || current_user && current_user.admin %>
							<div class="col-sm-3">
							<p><%= link_to "Edit", "#edit_comment_#{comment.id}_lb", class: "fancybox" %></p>
							</div>

							<!-- lightbox for editing this comment -->
							<div style="display:none;">
								<div id=<%="edit_comment_#{comment.id}_lb"%> >
									<%= form_for comment, url: update_comment_path(comment.id), html: {method: :patch} do |f| %>
										<p>
											<%= f.label :body, "Edit Your Comment!" %>
											<%= f.text_area :body, size: '50x20', :class => "form-control" %>
										</p><p>
											<%= f.submit "Edit Comment!", :class => "btn btn-lg btn-primary btn-block" %>
										</p>
									<% end %>
								</div>
							</div>

						<% end %>
					</div> <!-- end of well or blog-post -->

				<% end %>
			<% end %> <!-- end if comments -->
		</div> <!-- column -->

	<!-- lightbox for adding new comments -->
	<% if current_user %>	
		<div style="display:none;">
			<div id="add_comment_lb">
				<%= form_for @comment, url: comment_path(:user_id => current_user.id, :wawa_id => @wawa.id), html: {method: :post} do |f| %>
					<p>
						<%= f.label :body, "Tell Us About It!" %>
						<%= f.text_area :body, size: '50x20', :class => "form-control" %>
					</p><p>
						<%= f.submit "Comment!",:class => "btn btn-lg btn-primary btn-block" %>
					</p>
				<% end %>
			</div>
		</div>
	<% end %>
</div> <!-- container -->

	<!-- script for adding google map -->
	<script type="text/javascript">
		handler = Gmaps.build('Google');
		handler.buildMap({
				provider: {
					disableDefaultUI: false,
					// pass in other Google Maps API options here
				},
				internal: {
					id: 'gmap'
				}
			},
			function(){
				markers = handler.addMarkers(<%=raw @hash.to_json %>);
				handler.bounds.extendWith(markers);
				handler.fitMapToBounds();
				handler.getMap().setZoom(17);
			}
		);
	</script>

